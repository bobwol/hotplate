

define([
   "dojo/_base/declare",
   "dojo/cookie",
   "../buttons/_Button",
   "../buttons/_ManagerButton",
   ], function(
     declare
     , cookie
     , _Button
     , _ManagerButton
 ){

  var ret = {};


  var SignInRecoverRegisterResume = declare( [ _Button ], {
    strategyId: 'facebook',
    action: 'signin',

    postCreate: function(){
      var self = this;

      this.inherited( arguments );

      var action = self.action;
      if( action !== 'signin' && action !== 'recover' && action !== 'register' && action !== 'resume' ){
        action = 'signin';
      }

      this.button.on('click', function( e ){
        var consequence = 'redirect-opener';
        if( action === 'resume' ){
          consequence = 'close';
        } 
        cookie( 'facebook-' + self.action, consequence, { path: '/' } );
       
        window.open('/auth/' + self.action + '/facebook', '', 'width=800, height=600');
      });
    },
  });

  ret.SignIn = declare( [ SignInRecoverRegisterResume ], {
    action: 'signin'
  });

  ret.Recover = declare( [ SignInRecoverRegisterResume ], {
    action: 'recover'
  });

  ret.Register = declare( [ SignInRecoverRegisterResume ], {
    action: 'register'
  });

  ret.Resume = declare( [ SignInRecoverRegisterResume ], {
    action: 'resume'
  });

  ret.Manager = declare( [ _ManagerButton ], {

    strategyId: 'facebook',

    postCreate: function(){
      this.inherited( arguments );

      var self = this;

      self.button.on('click', function( e ){
        if( ! self.strategyData ){
          cookie( 'facebook-manager', 'close', { path: '/' } );
          window.open('/auth/manager/facebook', '', 'width=800, height=600');
        } else {
          self._deleteStrategyData( "Delete credentials?", "Are you sure you want to unlink your Facebook account?" );
        }
      });

    },

  });

  return ret;
});





