/*!
 * Module dependencies.
 */

var
  hotplate = require('hotplate')
, path = require('path')
;

var stores = {};

var hooks = exports.hotHooks = {};
var app = hotplate.app;

var toExpose = [];


hooks.init = function( done ){

  var registry = hotplate.getModule('hotCoreStoreRegistry');

  Object.keys( registry.storeRegistry ).forEach( function( storeName ){
    var storeEntry = registry.storeRegistry[ storeName ];

    var Store = storeEntry.Store;
    var storeObject = storeEntry.storeObject;

    // The store has a public URL: expose it as a variable for the application
    if( storeObject.publicURL ){
      toExpose.push( { Store: Store, storeObject: storeObject } );
    }
  })
  done( null );
}

hooks.init.after = [ 'hotCoreStoreRegistry' ];


hooks.run = function( done ){
  toExpose.forEach( function( item ) {
    console.log("EXPOSING STORE: " + item.storeObject.storeName + " WITH URL: " + item.storeObject.publicURL + "[" + item.storeObject.idProperty + "]");
    item.Store.onlineAll( app, item.storeObject.publicURL, item.storeObject.idProperty );
  });
  done( null );
}





