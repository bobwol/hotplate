/*!
 * Module dependencies.
 */

var
  hotplate = require('hotplate')
, path = require('path')
, hotCoreStoreRegistry = require( 'hotCoreStoreRegistry' )
;


// Run onlineAll for each store with a publicUrl attribute

hotplate.hotEvents.on( 'setRoutes', hotplate.cachable( function( app, done ){

  hotCoreStoreRegistry.getAllStores( function( err, allStores ){  
    
    Object.keys( allStores.stores ).forEach( function( storeName ){
      
      var storeEntry = allStores.stores[ storeName ];

      // The store has a public URL: add it to the list of stores to expose
      if( storeEntry.storeObject.publicURL ){
        storeEntry.Store.onlineAll( app, storeEntry.storeObject.publicURL, ':' + storeEntry.storeObject.idProperty );
      }
    });

    done( null );
  });
}))





