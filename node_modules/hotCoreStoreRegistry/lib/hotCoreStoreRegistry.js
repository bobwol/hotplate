/*!
 * Module dependencies.
 */

var 
  hotplate = require('hotplate')
, path = require('path')
;

exports.storeRegistry = {}
exports.collectionRegistry = {}

var hooks = exports.hotHooks = {};

hooks.init = function( done ){
  
  hotplate.invokeAll('stores', function(err, results){

    results.forEach( function( element ) {
      element.result.forEach( function( Store ){


        try {
         var store = new Store();
        } catch ( e ){
          console.log("AN ERROR HAPPENED WHILE INSTANCING A STORE: " );
          console.log( e );
          console.log( element );
          console.log( Store );
        }

        // If the store was created (no exception thrown...)
        if( store ){

           // Add the module to the store registry
           exports.storeRegistry[ store.storeName ] = { Store: Store, storeObject: store };

          // Add the module to the collection registry
          if( store.collectionName ){
            exports.collectionRegistry[ store.collectionName ] = exports.collectionRegistry [ store.collectionName ] || [];
            exports.collectionRegistry[ store.collectionName ].push( { Store: Store, storeObject: store }  );
          }

          // Add the module to the configStore registry
          //if( store.configStore ){
          //  exports.configStoreRegistry[ store.storeName ] = { Store: Store, storeObject: store };
          //}

        }

      });
      
    });
    done( null );
  });
}
hooks.init.invokes = [ 'stores' ];


