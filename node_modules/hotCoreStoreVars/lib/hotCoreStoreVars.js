"use strict";
/*!
 * Module dependencies.
 */

var dummy
, path = require('path')
, hotplate = require('hotplate')
, hotCoreStoreRegistry = require('hotCoreStoreRegistry')
;

hotplate.hotEvents.on('pageElements', 'hotCoreStoreVars', hotplate.cachable( function( done ){

  var stores = {};

  hotCoreStoreRegistry.getAllStores( function( err, registry ){

    Object.keys( registry.stores ).forEach( function( storeName ){
      var storeEntry = registry.stores[ storeName ];

      var Store = storeEntry.Store;
      var storeObject = storeEntry.storeObject;
  
      if( storeObject.publicURL ){
        var url = path.join( hotplate.config.get( 'hotCoreStoreExposer.storesUrlsPrefix' ), storeObject.publicURL );
        stores[ storeObject.storeName ] = { target: url, idProperty: storeObject.idProperty, sortParam: 'sortBy'  };
      }
    });
  });

  done( null, { vars: [
    { name: 'stores', value: stores } ] 
  } );

}));


