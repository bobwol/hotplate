/*!
 * Module dependencies.
 */

var 
  hotplate = require('hotplate')
, path = require('path')
, hotCoreStoreRegistry = require('hotCoreStoreRegistry')
;


var hooks = exports.hotHooks = {};

hooks.pageElements = function( done ){

  var cache = hooks.pageElements.cache;
  if( cache !== null ) return done( null, cache );
  cache = {};

  var stores = {};

  hotCoreStoreRegistry.getAllStores( function( err, registry ){

    Object.keys( registry.stores ).forEach( function( storeName ){
      var storeEntry = registry.stores[ storeName ];

      var Store = storeEntry.Store;
      var storeObject = storeEntry.storeObject;
  
      if( storeObject.publicURL ){
        stores[ storeObject.storeName ] = { target: storeObject.publicURL, idProperty: storeObject.idProperty, sortParam: 'sortBy'  };
      }
    });
  });

  cache = { 
    moduleName: 'hotCoreStoreVars', result: {
      vars:  [ { name: 'stores', value: stores } ],
    }
  };

  done( null, cache );
}
hooks.pageElements.cache = null;


