"use strict";
/*!
 * Module dependencies.
 */

var 
  hotplate = require('hotplate')
, hotCoreStoreRegistry = require('hotCoreStoreRegistry')
;


hotplate.hotEvents.on('pageElements', 'hotCoreStoreVars', hotplate.cachable( function( done ){

  var stores = {};

  hotCoreStoreRegistry.getAllStores( function( err, registry ){

    Object.keys( registry.stores ).forEach( function( storeName ){
      var storeEntry = registry.stores[ storeName ];

      var Store = storeEntry.Store;
      var storeObject = storeEntry.storeObject;
  
      if( storeObject.publicURL ){
        stores[ storeObject.storeName ] = { target: storeObject.publicURL, idProperty: storeObject.idProperty, sortParam: 'sortBy'  };
      }
    });
  });

  done( null, { vars: [
    { name: 'stores', value: stores } ] 
  } );

}));


