/*!
 * Module dependencies.
 */

var 
  hotplate = require('hotplate')
, path = require('path')
;

var stores = {};

var hooks = exports.hotHooks = {};

hooks.pageElements = function( done ){
  done( null, { moduleName: 'hotCoreStoreVars', result: {
    vars:  [ { name: 'stores', value: stores } ],
  } } );
}


hooks.init = function( done ){

  var registry = hotplate.getModule('hotCoreStoreRegistry');

  Object.keys( registry.storeRegistry ).forEach( function( storeName ){
    var storeEntry = registry.storeRegistry[ storeName ];

    var Store = storeEntry.Store;
    var storeObject = storeEntry.storeObject;
  
    // The store has a public URL: expose it as a variable for the application
    if( storeObject.publicURL ){
      stores[ storeObject.storeName ] = { target: storeObject.publicURL, idProperty: storeObject.idProperty, sortParam: 'sortBy'  };
    }
  });  
  done( null );
}

hooks.init.after = [ 'hotCoreStoreRegistry' ];

