define([
  'hotplate/hotDojoStores/JsonRest',
  'dojo/domReady!',
  ],function(
  JsonRest
  ){

  var stores = function( storeName, hash ){

    // If the global variable for the stores is defined...
    if(
      typeof( vars ) == 'object' &&
      typeof( vars.hotStoresVars ) == 'object' &&
      typeof( vars.hotStoresVars.stores ) == 'object'
    ){


      // Checks if the store name is `something:data`, in which case it will
      // create a store passing the parameter `dataSet` set properly
      var dataSet = '';
      var tokens;
      if( tokens = storeName.match(/^(.*):(.*)$/) ){
        storeName = tokens[1];
        dataSet = tokens[2];
      }

      var definedStores = vars.hotStoresVars.stores;
      if( typeof( definedStores[storeName]) !== 'undefined' ){

        definedStore = definedStores[storeName];

        target = definedStore.target;

        // Replace from the passed hash. This allows you to have stores like
        // /test/:workspaceIdCall/action and then create a store with the
        // hash "resolved" within the store's URL
        for(var k in hash){
          target = target.replace(':' + k, hash[k]);
        }

        // Create the store
        return new JsonRest({
          target: target,
          idProperty: definedStore.idProperty,
          sortParam: definedStore.sortParam,
          dataSet: dataSet,
        });
      }
    }
  }

  return stores;

});

