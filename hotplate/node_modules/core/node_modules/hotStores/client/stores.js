define([
  'app/JsonRest',
  'dojo/domReady!',
  ],function(
  JsonRest
  ){


  // Stores
  var stores = {},
      path,
      isAnon, isUser;
  

  // Make all of the stores, which will be used across the application
  [
    // Non-data calls
    'recoverAnon',
    'loginAnon',
    'logoutUser',

    // Data calls
    'workspacesAnon',
    'usersAnon', 
    'workspacesUser',

    // API calls (need a token ID to work)
    'users',
    'roles',
  ].forEach( function(i){

    // Check if the call is anonymous
    isAnon = i.match(/Anon$/);
    isUser = i.match(/User$/);

    // tokenValue = '873535f1b3c3cfffe76a68dfc9048647';
     
    // Either the token must be set, or the call needs to be a /user or /anon call
    if( workspaceIdValue || isAnon || isUser ){

      // Set the path depending on the store's name, to keep URL namespace clean
			// path = isAnon ? '/anon/' : ( isUser ?  '/user/' : '/api/1/' + tokenValue + '/') ;
      path = isAnon ? '/anon/' : ( isUser ?  '/user/' : ('/call/' + workspaceIdValue + '/') ) ;

      console.log("Creating store " + path + i + '/');

      // Create the store
      stores[i] = new JsonRest({
        target: path + i + '/',
		  	idProperty: '_id',
        sortParam: 'sortBy',
      });
    }
  });

  return stores;
});


