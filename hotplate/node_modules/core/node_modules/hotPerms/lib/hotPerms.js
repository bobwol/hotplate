var hotplate = require('hotplate')
  , path = require('path')
;

exports.hotHooks = hooks = {}


exports.checkPermissions = function( next,  store, method, data, doc, cb ){

  var authFailed = false;

  // Allows modules to enrich the Access schema, 
  hotplate.invokeAll('storePermissions', store, method, data, doc, function(err, results){
    results.forEach( function(element) {
      if( ! element ) {
        next( new Error("Auth failed") );
        authFailed = true;        
      }
    });
    if( ! authFailed ) cb();
  }); 
}



hooks.clientPaths = function( done ){
  done( null, { moduleName: 'hotPerms', result: [ path.join(__dirname, '../client') ] } );
}



