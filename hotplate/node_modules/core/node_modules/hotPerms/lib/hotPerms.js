var hotplate = require('hotplate')
  , path = require('path')
;

exports.hotHooks = hooks = {}


exports.checkPermissions = function(  req, next, store, data, doc, cb ){
  var e = hotplate.getModule('hotError').errors;

  var authFailed = false;

  // Allows modules to enrich the Access schema, 
  hotplate.invokeAll('storePermissions', req, store, data, doc, function(err, results){
    results.forEach( function(element) {
      if( ! element ) {
        next( new e.ForbiddenError() );
        authFailed = true;        
      }
    });
    if( ! authFailed ) cb();
  }); 
}



hooks.clientPaths = function( done ){
  done( null, { moduleName: 'hotPerms', result: [ path.join(__dirname, '../client') ] } );
}



